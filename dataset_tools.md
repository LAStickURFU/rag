# Инструменты для работы с данными в RAG-проекте

## Обзор

В директории `dataset_script` содержатся инструменты для сбора, обработки и анализа текстовых данных, которые используются в RAG-проекте. Эти инструменты позволяют автоматизировать процесс создания собственной базы знаний для информационного поиска и генерации ответов.

## Структура директории

```
dataset_script/
├── parser.py               # Скрипт для сбора данных с веб-сайтов
├── rag_dataset_analysis.py # Анализ текстового корпуса для RAG
├── sitemap.xml             # Карта сайта с URL для сбора данных (17720 ссылок)
├── Readme.md               # Документация по использованию скриптов
├── requirements.txt        # Зависимости для установки
├── text/                   # Каталог с извлеченными текстами (2712 файлов)
└── output/                 # Результаты анализа (статистика, графики, CSV/JSON)
```

## Описание компонентов

### 1. Сбор данных (`parser.py`)

**Назначение**: Парсинг веб-сайтов и извлечение текстового содержимого страниц.

**Функциональность**:
- Извлечение URL из файла sitemap.xml
- Управление браузером через Playwright для обхода защиты от парсинга
- Извлечение контента с помощью BeautifulSoup
- Асинхронная обработка с ограничением одновременных запросов
- Система повторных попыток и логирования ошибок

**Как запустить**:
```bash
python -m dataset_script.parser --sitemap dataset_script/sitemap.xml
```

### 2. Анализ данных (`rag_dataset_analysis.py`)

**Назначение**: Анализ собранного текстового корпуса для оценки его пригодности в задачах RAG.

**Функциональность**:
- Подсчет статистики (слова, символы, уникальные слова)
- Определение языка документов и выявление дубликатов
- Расчет метрик качества для RAG (TTR, noise ratio, paragraph structure)
- Симуляция разбиения на чанки разных размеров (256, 512, 1024 токена)
- Генерация визуализаций (облака слов, распределения длин)

**Как запустить**:
```bash
python -m dataset_script.rag_dataset_analysis
```

### 3. Каталог текстов (`text/`)

Содержит 2712 текстовых файлов (.txt), извлеченных из веб-страниц. Файлы именуются на основе URL-адресов источников.

**Использование в проекте**:
- Источник данных для индексации в векторной базе данных
- Материал для анализа качества и разнообразия контента
- Основа для тестирования и оценки работы RAG-системы

### 4. Результаты анализа (`output/`)

Содержит 30 файлов с результатами анализа, включая:
- `dataset_stats.csv` и `dataset_stats.json` - детальная статистика по каждому документу
- `dataset_summary.json` - сводная статистика по всему корпусу
- Различные визуализации (PNG, SVG, PDF) для распределений и облаков слов

## Основные результаты анализа

На основе анализа собранного корпуса выявлены следующие характеристики:

- **Размер корпуса**: 2712 документов на русском языке
- **Объем данных**: 1.5 млн слов, 11 млн символов
- **Качество данных**: 14 дубликатов (0.5%), среднее TTR 0.70
- **Распределение размеров**:
  - 27% документов (733) содержат менее 100 слов
  - 39% документов (1063) содержат 100-299 слов
  - 34% документов (916) содержат 300+ слов
- **Эффективность чанкинга**:
  - Для чанка размером 256 токенов: в среднем 2.74 чанка на документ
  - Для чанка размером 512 токенов: в среднем 1.77 чанка на документ
  - Для чанка размером 1024 токенов: в среднем 1.30 чанка на документ

## Применение в проекте

Данные инструменты можно использовать для:

1. **Подготовки собственной базы знаний** - сбор и обработка текстов по нужной тематике
2. **Оценки качества корпуса** - выявление проблем и особенностей собранных данных
3. **Оптимизации параметров RAG** - подбор оптимального размера чанка и стратегии индексации
4. **Визуализации для исследований** - наглядное представление характеристик корпуса

## Интеграция с основной системой

Для интеграции собранных данных с RAG-системой:

1. Запустите скрипт парсера для сбора данных из нужных источников
2. Проанализируйте собранный корпус с помощью скрипта анализа
3. Настройте параметры чанкинга в основной системе на основе результатов анализа
4. Используйте каталог `text/` как источник для индексации через эндпоинт `/documents/upload` 